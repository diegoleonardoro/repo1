<!DOCTYPE html>
<html>

<head>
    <style>

        #tooltip{ 
            position: absolute; 
            z-index: 2; 
            color:white; 
            font-size: 14px; 
            padding:5px;     
            font-family: "HelveticaNeue-Light", "Helvetica Neue Light", 
            "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif; 
        }

        .form{
            position: relative;
            left: 30%;
            top: 30%;
        }


        table, th, td {
            border: 1px solid black;
        }

        #feed{
            position: relative;
            left: 30%;
            top: 30%;
        }

        input {
        margin: .70rem 0;
        }

        .dropbtn {
            background-color: #3498DB;
            color: white;
            padding: 16px;
            font-size: 16px;
            border: none;
            cursor: pointer;
        }

        .dropbtn:hover, .dropbtn:focus {
            background-color: #2980B9;
        }

        .dropdown {
            margin-top: 25px;
            position: absolute;
            display: inline-block;
            top: 40px;
            right: 100px;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f1f1f1;
            min-width: 160px;
            overflow: auto;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
        }

        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }

        #buttonName{
            margin-top: 25px;
        }
        
        #username{
            margin-top: 25px;
        }

        #favPlace{
            margin-top: 25px;
        }
        .show {display: block;}

        .field-name,
        .field-address,
        .field-image{
            position:absolute;
            top:50%;
            left: 40%;

            /*transform: translate(-50%, -50%); */
         
            background: #b4f2fa;
            height:50px;
            width: 400px;
            display:flex;
            justify-content: space-between;
            align-items:center;
            border-radius: 5px;
            transition:all 0.5s ease;
        }

        .field-image{
            position:absolute;
            top:50%;
            left: 32%;

            /*transform: translate(-50%, -50%); */
         
            background: #b4f2fa;
            height:50px;
            width: 680px;
            display:flex;
            justify-content: space-between;
            align-items:center;
            border-radius: 5px;
            transition:all 0.5s ease;

        }





        .field-finish{
            position:absolute;
            top:50%;
            left: 40%;
            background:#76e9f8;
            height:50px;
            width: 400px;
            display:flex;
            justify-content: space-between;
            align-items:center;
            border-radius: 5px;
            transition:all 0.5s ease;
        }

        .field-reason{
            position:absolute;
            top:50%;
            left: 32%;
            background: #b4f2fa;
            height:300px;
            width: 700px;
            display:flex;
            justify-content: space-between;
            align-items:center;
            border-radius: 5px;
            transition:all 0.5s ease;
        }



        .field-name i,
        .field-address i, 
        .field-reason i, 
        .field-finish i,
        .field-image i{
            padding:10px;
            cursor:pointer;

        }
        
        div.innactive{
            opacity:0;
            pointer-events:none;
            /*transform: translate(-50%,-50%);*/
        }

        div.active{
            opacity: 1;
            pointer-events: all;
           /* transform: translate(-50%, -50%);*/
        }

        .field-name input,
        .field-address input, 
        .field-finish input,
        .field-finish input{
            background:none;
            border:none;
            flex: 1;
            height: 100%;
            outline:none;
            padding-top: -100px;
        }

        .field-reason input{
            background:none;
            border:none;
            flex: 1;
            height: 100%;
            outline:none;
            padding-bottom: 240px;
            margin-left: 30px;
        }

        #map{
            padding-top: 100px;
            margin-left: 200px;        
        }

        #feed{
            margin-top: 30px
        }

    </style>

    <meta charset="utf-8">
    <title>CB2 BX Social Platform</title>
    <link rel="stylesheet" href="./style.css" />
    <div id="userName"></div>


</head>


<body>

    <!--
    <div class="form">
        <div>
            <h2>Residents of Community Board 2 in The Bronx:</h2>
            <p>Places are the day-to-day setting of this movie called "Your Life". Tell us the stories that <br> have
                occurred
                in those places.It could be the coffee shop around the corner, your own apartment,<br> a place that you
                used to
                visit or any other site that has emotional meaning to you. </p>
        </div>
        <form id="initialForm">
            Your Name: <input id="username" type="text" name="name"><br>
            Address of Your Place: <input id="favPlace" type="text" name="address"><br>
            <p>Why is this place important to you: </p>
            <textarea id="placeReason" name="reason" rows="4" cols="50" placeholder="Type here..."></textarea>
            <br>
            <button id="buttonName" type="submit">Send Information</button>

        </form>
    </div>
    -->

    <form id="form2">
        <div class="field-name">
            <i class="fas fa-user"></i>
            <input name="text" placeholder="Your Name" required />
            <i class="fas fa-arrow-down"></i>
        </div>

        <div class="field-address innactive">
            <i class="fas fa-house-user"></i>
            <input name="address" placeholder="Address of the place you want to share" required />
            <i class="fas fa-arrow-down"></i>
        </div>

        <div class="field-reason innactive">
            <input id="reason" name="reason" placeholder="Explain why this place is important to you" color="red"
                required />
            <i class="fas fa-arrow-down"></i>
        </div>


        <div class="field-image innactive">
            <i class="far fa-images"></i>
            Select an image of your place:
            <input type="file" name="image" id="image">
            <i class="fas fa-arrow-down"></i>
        </div>



        <div class="field-finish innactive">
            <i class="far fa-paper-plane"></i>
            <input type="submit" name="submit" value="Send Data" />
            <i class="far fa-paper-plane"></i>
        </div>


    </form>




    <div id="mapDiv">
        <div id="feed"></div>
        <div id="map"></div>
        <div id="streetsMap"></div>
        <div id="tooltip"></div>
        <div id="container" class="svg-container"></div>
    </div>




    <script src="http://d3js.org/d3.v4.min.js" charset="utf-8"></script>
    <script src="https://unpkg.com/topojson@3"></script>
    <script src="https://js.api.here.com/v3/3.1/mapsjs-core.js" type="text/javascript" charset="utf-8"></script>
    <script src="https://js.api.here.com/v3/3.1/mapsjs-service.js" type="text/javascript" charset="utf-8"></script>
    <script type="module" src="https://js.api.here.com/v3/3.1/mapsjs.bundle.js"></script>
    <script src="https://kit.fontawesome.com/a8ea7ecad9.js" crossorigin="anonymous"></script>




</body>


<script>

    // ====  HANLDE THE INPUT VALUES FROM THE DYNAMIC FORM === //

    function animatedForm() {
        const arrows = document.querySelectorAll(".fa-arrow-down");

        arrows.forEach(arrow => {
            arrow.addEventListener("click", () => {
                //console.log("clicked");
                const input = arrow.previousElementSibling; // every time we click on the arrow the input changes.
                const parent = arrow.parentElement;
                const nextForm = parent.nextElementSibling;

                if (input.name === "text" && validateUser(input)) {
                    nextSlide(parent, nextForm, -400);
                } else if (input.name === "address" && validateAddress(input)) {
                    nextSlide(parent, nextForm, -300);
                } else if (input.name === "reason" && validateUser(input)) {
                    nextSlide(parent, nextForm, -200);
                    nextForm.style.transform = "translateY(" + 140 + "px)";

                } else if (input.name === "image") {
                    nextSlide(parent, nextForm);
                    nextForm.style.transform = "translateY(" + 225 + "px)";

                }
            })
        })
    }


    function validateUser(user) {
        if (user.value.length < 2) {
            console.log("Not enough characters");
            error("rgb(189,87,87)");
        } else {
            error("white");
            return true;
        }
    }

    function validateAddress(address) {
        // const validation = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (address.value.length > 3) {

            error("white");
            return true;
        } else {
            error("rgb(189,87,87)");
        }
    }


    function nextSlide(parent, nextForm, transformValue) {
        parent.style.transform = "translateY(" + transformValue + "px)";
        // parent.classList.add("innactive");
        // parent.style.top = topPosition + 'px';
        //parent.classList.remove("active");

        nextForm.classList.add("active");

    }




    function error(color) {
        document.body.style.backgroundColor = color;
    }


    animatedForm()




    // ======================================================= //



    // ==== GEOCODING FUNCTION WITH "HERE" ==== //
    var platform = new H.service.Platform({
        'apikey': 'SdaD00BDUGuznS-sRFe7C_zPT3YkMPgcHBlHnbQL85A'
    });
    var service = platform.getSearchService();

    // ---- function --- //
    function getPlaceInfo(placeAddress, callback) { // I included the operation inside a function 
        setTimeout(() => {
            service.geocode({
                q: placeAddress
            }, (result) => {
                callback(null, result)
            }, alert);
        }, 1000);
    };

    // ======================================= //

    // ====================================== //



    /*
    form.addEventListener("submit", function (e) {
        e.preventDefault()
        var initialForm = document.getElementById("initialForm");
        var name = initialForm.elements.name.value;
        var placeAddress = initialForm.elements.address.value;
        var reason = initialForm.elements.reason.value;

        var values = {
            "name": name,
            "address": placeAddress,
            "reason": reason,
            "coordinates": ''
        }
        var address = values.address

        //==== THIS FUNCTION DOES THE POST REQUEST TO "/status/input" ==== //
        //==== IT INCLUDES THE RESULTS OF THE "getPlaceInfo" FUNCTION==== //
        getPlaceInfo(address, (error, response) => {
            values.coordinates = response.items[0].position
            const options = {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(values)
            };
            fetch("/status/input", options);
        })
    })
    */



    // =================================== //
    /*
    // THE FOLLOWINF BLOCK WILL APPEND THE DOM ELEMENTS THAT WILL DISPLAY THE DATA SUBMITTED BY THE USER 

        var feed = document.getElementById("feed");
        var author = document.createElement("p");
        author.innerHTML = "Published by: " + name;
        var address = document.createElement("p");
        address.innerHTML = "Address: " + placeAddress;


        var table = document.createElement("table");
        table.setAttribute = ("id", "placeTable");
        var tableContReason = document.createElement("td");
        tableContReason.innerHTML = reason;
        var tablePhoto = document.createElement("td");
        tablePhoto.innerHTML = "Here we'll put a photo";
        table.appendChild(tableContReason);
        table.appendChild(tablePhoto);

        feed.appendChild(author);
        feed.appendChild(address);
        feed.appendChild(table);
        // geoCoding(address)

    }
    */



    //-----------------------------------------------------------------//
    //-----------------------------------------------------------------//
    //-----------------------------------------------------------------//

    //------------------------- WEBSOCKETS ---------------------------//
    var wsUri = "ws://localhost:8080";
    var ws = new WebSocket(wsUri);
    ws.onopen = function (evt) {
        console.log("1. Connected (from Client)")
    }
    ws.onmessage = function (message) {
        var messageArray = JSON.parse(message.data)
        console.log("5. This is the list of user names:", messageArray)
        var lastName = messageArray[messageArray.length - 1]
        if (typeof messageArray != "object") { // This lets us only send the username to the funciton "listOfUsers"
            listOfUsers(messageArray);
        }
    }
    //-----------------------------------------------------------------//



    //-------------------------- FUNCTIONS ----------------------------//

    function sendUserName() {
        var name = document.getElementById("username").value;
        ws.send(JSON.stringify(name))
        var userNameDiv = document.getElementById("userName")
        var userName = document.createElement("p")
        userName.innerHTML = "Your user name is: " + name
        userNameDiv.appendChild(userName)
    }

    function listOfUsers(name) {
        var node = document.createElement("LI")
        var textNode = document.createTextNode(name)
        node.appendChild(textNode)
        document.getElementById("listOfUsers").appendChild(node);
    }

    function showContent() {
        var dropDown = document.getElementById("listOfUsers")
        dropDown.classList.toggle("show");
        // .classList.add("show");
        // dropDown.style.display = "block"
    }

    function sendAddress() {
        var locations = {}
        var value = document.getElementById("favPlace").value;
        locations.address = value
        ws.send(JSON.stringify(locations))
        console.log(typeof locations)

    }


    //------------------ MAKE THE FUNCTION THAT WILL DO THE GEOCODING ---------------------//

    /* 
    // Not working ( (index):204 Uncaught ReferenceError: require is not defined)
        var geoCoding = function (address) {
            let options = {
                provider: 'openstreetmap'
            };
            let geoCoder = nodeGeocoder(options);
            geoCoder.geocode(address)
                .then((res) => {
                    console.log(res);
                })
                .catch((err) => {
                    console.log(err);
                });
        }
    
      */
    //--------------------------------------------------------------------------------------//
    //--------------------------------------------------------------------------------------//
    //--------------------------------------------------------------------------------------//





    // ====================== MAP ====================== //
    // ====================== MAP ====================== //
    // ====================== MAP ====================== //
    // ====================== MAP ====================== //
    // ====================== MAP ====================== //

    (function () {

        var height = 900,
            width = 1200,
            projection = d3.geoMercator(), // geoMercator() is a way of projecting the map. 
            nyc = void 0,
            map = void 0,
            streetMap = void 0,
            nycStreets = void 0;

        // ------------ Zoom ------------ //
        // Create the function that will allow the zoom to happen:
        // d3.event.transform.k: This defines the zoom level in terms of an SVG scale.
        // d3.event.transform.x and .y: These define the positions of the map in relation to the mouse in terms of an SVG translate.
        var zoomed = function () {
            map.attr("transform", "translate(" + d3.event.transform.x + "," + d3.event.transform.y + ") scale(" + d3.event.transform.k + ")");
        }

        // set up the zoom behavior
        var zoom = d3.zoom()
            .scaleExtent([1, 8])
            .on("zoom", zoomed)
        // ------------------------------ //



        // ------------ Path & Projection ------------ //

        var path = d3.geoPath().projection(projection); // d3.geoPath() is the D3 Geo Path Data Generator helper class for generating SVG 
        //  Path instructions from GeoJSON data.
        // ------------------------------------------- //



        // ------------ Appending the SVG ------------ //
        var svg = d3.select("#map")
            .append("svg")
            .attr("class", "generalSVG")
            .attr("width", width)
            .attr("height", height)
            .call(zoom);
        // ------------------------------------------- //




        // --------- Reading NYC's boundaries ----------- //

        d3.json('geo-data.json', function (error, data) {
            if (error) return;

            //-----------Selecting the geometry features from the json OBJ------------------//

            var districts = topojson.feature(data, data.objects.districts); // inside topojson.feature we have to put the element where the "geometries" live. 
            //------------------------------------------------------------------------------//

            console.log("districts", districts);

            //-----------------------------FUNCTIONS---------------------------//
            var GeoID = function (d) { // Lets us assign a unique value to each element in the "districts" OBJ
                return "c" + d.id
            }
            //-----------------------------------------------------------------//
            var click = function (d) { //sets opacity to 0.3 to all paths in the "districts" OBJ except the one that is clicked 
                d3.selectAll("path").attr("fill-opacity", 0.3)
                d3.select("#" + GeoID(d)).attr("fill-opacity", 1)
                var index = districts.features.indexOf(d)
                var b = path.bounds(districts.features[index])
            }
            //-----------------------------------------------------------------//
            var findIndex = function (d) { // Finds the index of a specific element in the "districts" OBJ
                console.log(districts.features.indexOf(d));
            }
            //-----------------------------------------------------------------//


            var hover = function (d) { // Displays a tooltip when hoover a specific element in the "districts" OBJ
                var div = document.getElementById("tooltip")
                div.style.left = event.pageX + "px";
                div.style.top = event.pageY + "px";
                div.innerHTML = d.id;
            }



            //-----------------------------------------------------------------//


            var color = d3.scaleLinear()
                .domain([0, 73])
                .range(['yellow', 'orange']);

            var color = function (d, i) { // Gives a different color to the element in the "district" OBJ that belongs to CB2 Bronx
                if (d.id === 202) { return "#f49f1c" }
                else { return "#f49f1c" }
            }
            //-----------------------------------------------------------------//

            var fillOpacity = function (d, i) {// Sets opacity of 1 to the element that belongs to CB2 Bronx, and the rest reveice an opacity of 0.2
                if (d.id === 202) { return 1 }
                else { return .2 }
            }

            //-----------------------------------------------------------------//



            //-----------------------------SCALE AND TRANSLATE---------------------------//

            var b, s, t;
            projection.scale(1).translate([0, 0]);
            var b = path.bounds(districts); // bounds represent a two dimensional array : [[left, bottom], [right, top]],
            var s = .9 / Math.max((b[1][0] - b[0][0]) / width, (b[1][1] - b[0][1]) / height);
            var t = [(width - s * (b[1][0] + b[0][0])) / 2, (height - s * (b[1][1] + b[0][1])) / 2];
            projection.scale(s).translate(t);



            // left   ------> minimum longitude.
            // bottom ------> minimum latitude.
            // right  ------> maximum longitude.
            // top    ------> maximum latitude.  
            /*
            b:
            [[-1.296004583759824, -0.783911032655179]
            [-1.2863080344472297, -0.7742547797474023]]
            */
            /*
            b[1][0] -1.2863080344472297
            b[0][0] -1.296004583759824
            b[1][1] -0.7742547797474023
            b[0][1] -0.783911032655179
            */
            //-------------------          (        418.279        )  ---------------//
            //-------------------  0.9/ (   0.000008333333   ) , (     0.00173      )  ---------------//
            //------------------- ((-1.286  -  1.296) /  1200), ((-0.774  - 0.783) / 900)  ---------------//
            //------------------- (max lon - min lon /  1200), (max lat - min lat / 900) ---------------//

            // The relationship between the real world size of a geographic feature and its representative 
            // feature on a map is known as scale

            // The max value should be 0.000010729169897529688
            //console.log("s", s); // ------>  83883.46988588729

            //console.log("t", t);

            //----------------------------------------------------------------------------//




            // ----------------- APPENING G ELEMENT AND INJECTING THE DATA -----------------//

            map = svg.append('g').attr('class', 'boundary'); // In this "g" tag we will include the path for the district boundaries.
            nyc = map.selectAll('path').data(districts.features);

            //console.log("districts", districts)
            //console.log("districts.features", districts.features)

            //Enter
            nyc.enter()
                .append('path')
                .attr('d', path)
                .attr("id", GeoID) // <--- Here we are assigning a unique id to every path in thr OBJ
                .style("stroke", "black")
                //.on("click", click)
                //.on("mouseover", hover)
                //.attr('fill', function (d, i) { // <========----------
                //   return color(i);
                //});
                .style("fill-opacity", fillOpacity)
                .attr("stroke-width", .2)
                .attr("fill", color)

            // Update
            nyc.attr('fill', '#eee');
            //Exit
            nyc.exit().remove();


            //---------------------------------------------------------------------------------------//

            // Call the zoom behavior to the base element:
            /*
                            svg.append("rect") 
                                .attr("class", "overlay")
                                .attr("width", width)
                                .attr("height", height)
                                .call(zoom);
            */
            //---------------------------------------------------------------------------------------//


        });

        //------------------- READING THE STREETS TO BE DISPLAYED ON THE MAP ----------------------//
        d3.json("nyc-streets.json", function (error, data) {

            //var streets = topojson.feature(data, data) // inside topojson.feature we have to put the element where the "geometries" live. 
            // console.log("data.json", data);

            var streets = data
            //------------------- SELECT ONLY THE STREETS OF THE BRONX  ----------------------//
            var bx = function () { // <--- We select only the streets that belong to The Bronx. 
                var bx_ = []
                for (var i = 0; i < streets.features.length; i++) {
                    if (streets.features[i].properties["COUNTYFP"] === "005") {
                        bx_.push(streets.features[i])
                    }
                }
                return bx_
            }
            var bx__ = bx()


            //--------------------------------------------------------------------------------//
            //-----------------------SCALE AND TRANSLATE OF BRONX STREETS--------------------//
            var b, s, t;
            projection.scale(1).translate([0, 0]);
            var b = path.bounds(streets); // bounds represent a two dimensional array : [[left, bottom], [right, top]],
            // left   ---->  minimum longitude.
            // bottom ---->  minimum latitude.
            // right  ---->  maximum longitude.
            // top    ---->  maximum latitude.  

            //--- The "scale" and "translate" values of the streets need to match those of the map boundaries --- //
            var s = 83883.46988588729;
            var t = [108906.67137265907, 65802.17750094552];

            //var s = .9 / Math.max((b[1][0] - b[0][0]) / width, (b[1][1] - b[0][1]) / height);
            //var t = [(width - s * (b[1][0] + b[0][0])) / 2, (height - s * (b[1][1] + b[0][1])) / 2];

            projection.scale(s).translate(t);
            //--------------------------------------------------------------------------------//

            //---------------- APPEND A "G" TAG TO THE PREVIOUSLY CREATED MAP ----------------//
            //--------------------- ADD THE STREETS TO THIS NEW "G" TAG ---------------------//
            streetMap = map.append("g").attr("class", "boundary2"); // We append another "g" element to the "g"
            nycStreets = streetMap.selectAll("path").data(bx__)
            nycStreets.enter()
                .append("path")
                .attr("d", path)
                .attr("stroke-width", "0.1")
                .attr("stroke-opacity", "0.3")
                .style("fill-opacity", 0)
                .style("stroke", "black")
            nycStreets.attr("fill", "#eee");
            nycStreets.exit().remove()
            //--------------------------------------------------------------------------------//





            // ------------ ADD AN EVENT LISTENER TO THE SUBMIT BUTTON ------------ //
            // ----------------- DISPLAY THE ADDRESS ON THE MAP ------------------- //

            const form = document.getElementById("form2");

            form.addEventListener("submit", function (e) {

                e.preventDefault()

                var mapDiv = document.getElementById("mapDiv")

                mapDiv.style.transform = "translateY(" + 1000 + "px)";

                var feed = document.getElementById("feed");

                var initialForm = document.getElementById("form2");
                var name = initialForm.elements.text.value;
                var reason = initialForm.elements.reason.value;
                var placeAddress = initialForm.elements.address.value;

                var imageInput = document.querySelector("#image"); // <<<< image selector. 


                // Put the load image element inside the form. 


                getPlaceInfo(placeAddress, (error, response) => {

                    var coords = [response.items[0].position]
                    var circle = map.append("circle")
                        .attr("cx", projection([coords[0].lng.toString(), coords[0].lat.toString()])[0])
                        .attr("cy", projection([coords[0].lng.toString(), coords[0].lat.toString()])[1])
                        .attr("r", 6)
                        .attr("fill", "blue");

                    var values = {
                        "name": name,
                        "address": placeAddress,
                        "reason": reason,
                        "coordinates": coords,
                    }

                    console.log("values", values);

                    

                    // ===================================================================//
                    // ===================================================================//
                    // ========  USING FormData() TO UPLOAD FILES VIA FETCH API ========= //
                    // ===================================================================//
                    // ===================================================================//

                    let h = new Headers();
                    h.append("Accept", "application/json");

                    let fd = new FormData();

                    fd.append("name", name);
                    fd.append("address", placeAddress);
                    fd.append("reason", reason);
                    fd.append("coordinates", JSON.stringify(coords));
                    let sitePhoto = document.getElementById("image").files[0];
                    fd.append("image", sitePhoto);

                    let req = new Request("/status/input", {
                        method: "POST",
                        headers: h,
                        mode: "no-cors",
                        body: fd
                    });

                    console.log("req", req);

                    fetch(req)


                    // ===================================================================//
                    // ===================================================================//
                    // ===================================================================//
                    // ===================================================================//


                    // ================ SEND THE DATA VIA FETCH ================ //
                    /*
                    const options = {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify(values)
                    }
                    fetch("/status/input", options); // This route has to be defined on the server side as a "POST" method.
                    */
                    // ========================================================= //






                    // ===== CREATE DOM ELEMENTS TO DISPLAY THE USER INPUT DATA ===== //

                    var author = document.createElement("p");
                    author.innerHTML = "Published by: " + name;

                    var address = document.createElement("p");
                    address.innerHTML = "Address: " + placeAddress;



                    var table = document.createElement("table");
                    table.setAttribute = ("id", "placeTable");

                    var tableContReason = document.createElement("td");
                    tableContReason.innerHTML = reason;



                    // ===  CREATE THE CANVAS === //
                    var canvasTD = document.createElement("td")
                    canvasTD.style.verticalAlign = "middle";

                    var tableCanvas = document.createElement("canvas");
                    //ableCanvas.style.height = "480px";
                    //tableCanvas.style.width = "640px";
                    tableCanvas.innerHTML = showPhoto();

                    canvasTD.appendChild(tableCanvas);  // <<<<<<


                    // tableCanvas.style.height = "1000px"; // <<<<<<
                    // tableCanvas.style.width = "1000px";  // <<<<<<

                    // canvasTD.style.height = "1000px";  // <<<<<<
                    // canvasTD.style.width = "1000px";  // <<<<<<



                    function resizeCanvas(canvasHeight, canvasWidth) {

                        let height = canvasHeight;
                        let width = canvasWidth;

                        tableCanvas.style.height = height + "px"; // <<<<<<
                        tableCanvas.style.height = width + "px"; // <<<<<<

                        canvasTD.style.height = height + "px"; // <<<<<<
                        canvasTD.style.width = width + "px";

                        if (height > 550 && width > 730) {
                            height /= 2;
                            width /= 2;

                            tableCanvas.style.height = height + "px"; // <<<<<<
                            tableCanvas.style.height = width + "px"; // <<<<<<

                            canvasTD.style.height = height + "px"; // <<<<<<
                            canvasTD.style.width = width + "px";
                        }
                    }


                    function showPhoto() {
                        let context = tableCanvas.getContext("2d");
                        if (imageInput.files && imageInput.files[0]) {
                            let reader = new FileReader();
                            reader.onload = () => {
                                let image = new Image();
                                image.onload = () => {

                                    console.log("image.height", image.height);
                                    console.log("image.width", image.width);

                                    tableCanvas.height = image.height; // <<<<<<
                                    tableCanvas.width = image.width; // <<<<<<

                                    // canvasTD.height = image.height; // <<<<<<
                                    // canvasTD.width = image.width;  // <<<<<<

                                    context.clearRect(0, 0, tableCanvas.height, tableCanvas.width);
                                    context.drawImage(image, 0, 0);

                                    resizeCanvas(image.height, image.width);
                                }
                                image.src = reader.result;
                            };
                            reader.readAsDataURL(imageInput.files[0]);
                        }
                    }

                    // imageInput.addEventListener("change", showPhoto()) //<<<<<<<<< Cannot read property 'addEventListener' of null 


                    //tablePhoto.innerHTML = "Here we will put a photo";

                    table.appendChild(tableContReason);

                    table.appendChild(canvasTD);  // <<<<<<

                    feed.appendChild(author);
                    feed.appendChild(address);
                    feed.appendChild(table);


                    window.scrollTo(0, 1000);


                })
            })









            /*
            //------------ READ THE DATA OF THE POINTS OF INTEREST TO BE DISPLAYED------------//
            d3.csv('pointsOfInterest.csv', function (places) {

                //------------CREATE THE FUNCTION THAT WILL DISPLAY THE TOOLTIP---------------//
                var hoverPoints = function (d) {
                    //------------CREATE THE DIMENSIONS AND POSITION OF THE TOOLTIP-----------//
                    var toolTipDiv = document.getElementById("tooltip")
                    toolTipDiv.style.left = event.pageX + 16 + "px";
                    toolTipDiv.style.top = event.pageY + 16 + "px";
                    toolTipDiv.style.background = "green";
                    // div.style.width = 400 + d.name.length + "px";
                    toolTipDiv.style.width = 460 + "px";
                    //var wordLength = d.name.split(' ').length;
                    //div.style.height = 240 + "px";
                    toolTipDiv.style.height = 300 + "px";
                    toolTipDiv.style.opacity = "1";
                    toolTipDiv.innerHTML = d.name;

                    console.log("cx", projection([d.lon, d.lat])[0]) // This console logs the values to be displayed on the map 
                    console.log("cy", projection([d.lon, d.lat])[1])

                    //----CALL THE FUNCTION THAT WILL DISPLAY THE LINE INSIDE THE TOOLTIP-----//
                    //showGraph(d.name);

                }
                //--------- CREATE THE FUNCTIONS THAT WILL MAKE THE TOOLTIP DISSAPEAR ---------//
                var hoverPointsOut = function () {
                    var div = document.getElementById("tooltip")
                    div.style.transition = "all .3s";
                    div.style.opacity = "0";
                }

                //--------- DISPLAY THE POINTS ON THE MAP ---------//
                var points = map.selectAll("circle").data(places);
                var text = map.selectAll("text").data(places);
                var radius = d3.scaleLinear().domain([0, 500000]).range([5, 30])

                points.enter()
                    // The x and y coordinates are determined by calling our previous projection() function with the corresponding latitude and longitude coordinates from the data file.
                    // Note that the projection() function returns an array of x and y coordinates (x, y). The x coordinate is determined by taking the 0 index of the returned array. The y coordinate is determined from the index, 1.
                    .append("circle")
                    .attr("cx", function (d) { return projection([d.lon, d.lat])[0] })
                    .attr("cy", function (d) { return projection([d.lon, d.lat])[1] })
                    .attr("r", 1.8)
                    .attr("fill", "red")
                    .on("mouseover", hoverPoints)
                    .on("mouseout", hoverPointsOut);


                // The x and y coordinates are determined by calling our previous projection()
                // Note that the projection() function returns an array of x and y coordinates (x, y).
                // The x coordinate is determined by taking the 0 index of the returned array. 
                // The y coordinate is determined from the index, 1 

                text.enter()
                    .append("text")
                    .attr("x", function (d) { return projection([d.lon, d.lat])[0] })
                    .attr("y", function (d) { return projection([d.lon, d.lat])[1] })
                    .attr("dx", 5)
                    .attr("dy", 3)
                    .text(function (d) { return d.name })
            })
            */

        })



        var showGraph = function (place) {
            d3.csv("numberofVisitors.csv", function (data) {

                const timeConv = d3.timeParse("%d-%b-%Y");
                const width_ = 570;
                const height_ = 300;
                const margin_ = 5;
                const padding_ = 5;
                const adj_ = 30;

                const slices = data.columns.slice(1).map(function (id) {
                    return {
                        id: id,
                        values: data.map(function (d) {
                            return {
                                date: timeConv(d.date),
                                measurement: +d[id]
                            };
                        })
                    }
                });

                var currentPoint = function () {
                    for (var i = 0; i < slices.length; i++) {
                        if (slices[i].id === place) {
                            return slices[i]
                        }
                    }
                }
                console.log("slices", slices)

                console.log(currentPoint())

                //for (var i = 0; i < slices.length; i++) {
                //    console.log(slices[i].id)
                //}



                const xScale = d3.scaleTime().range([0, width_]);
                const yScale = d3.scaleLinear().rangeRound([height_, 0]);


                xScale.domain(d3.extent(data, function (d) {
                    return timeConv(d.date)
                }));

                yScale.domain([(0), d3.max(slices, function (c) {
                    return d3.max(c.values, function (d) {
                        return d.measurement + 4;
                    })
                })
                ]);

                const svg_ = d3.select("#tooltip")
                    .append("svg")
                    .attr("preserveAspectRatio", "xMinYMin meet")
                    //.attr("width", width_ )
                    //.attr("height", height_  )
                    .attr("viewBox", "-"
                        + adj_ + " -"
                        + adj_ + " "
                        + (width_ + adj_ * 3) + " "
                        + (height_ + adj_ * 3))
                    .style("padding", padding_)
                    .style("margin", margin_)
                    .classed("svg-content", true);


                //----------------------------------------------------------------------------//

                const yaxis = d3.axisLeft()
                    .scale(yScale)
                    .ticks((slices[0].values).length); // This part specifies a set number of ticks for the y axis (14, or as many as there are array elements / csv rows).

                const xaxis = d3.axisBottom()
                    .ticks(d3.timeDay.every(1)) // The format of displayed dates will show the day and the abbreviated month for each tick.
                    .tickFormat(d3.timeFormat('%b %d')) // The x axis a tick will be displayed with a granularity of a "day", every day.
                    .scale(xScale);

                //----------------------------------------------------------------------------//


                svg_.append("g")
                    .attr("class", "axis")
                    .attr("transform", "translate(0," + height_ + ")")
                    .call(xaxis)


                svg_.append("g")
                    .attr("class", "axis")
                    .call(yaxis)
                    //this you append
                    .append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("dy", ".75em")
                    .attr("y", 6)
                    .style("text-anchor", "end")
                    .text("Frequency")


                const line = d3.line()
                    .x(function (d) { return xScale(d.date); })
                    .y(function (d) { return yScale(d.measurement); })


                const lines = svg_.selectAll("lines")
                    .data([currentPoint()]) // <=====================---------------------------
                    .enter()
                    .append("g");


                lines.append("path")
                    .attr("d", function (d) { return line(d.values); })
                    .style("fill", "none")
                    .style("stroke", "white")

            })
        }
    })();

     // ====================== === ====================== //



</script>


</html>